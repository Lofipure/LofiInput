"use strict";(self.webpackChunkLofiInput=self.webpackChunkLofiInput||[]).push([[433],{9874:function(Re,Z,E){E.r(Z),E.d(Z,{default:function(){return Ce}});var ee=E(42122),G=E.n(ee),te=E(27424),D=E.n(te),ne=E(94184),j=E.n(ne),d=E(67294),z=E(73935),y=E(85893),ae=function(l){var r=l.mentionAtom,t=l.lofiInputEle,n=l.setLofiInputEditable,s=r.classname,c=r.placeholder,R=(0,d.useState)(!1),A=D()(R,2),h=A[0],w=A[1],S=(0,d.useState)(),v=D()(S,2),m=v[0],M=v[1],I=(0,d.useRef)(null),C=function(){var g=I.current;if(g){n==null||n(!1),w(!0);var f=window.getSelection();f==null||f.removeAllRanges();var p=document.createRange();p==null||p.selectNodeContents(g),f==null||f.addRange(p),setTimeout(function(){g==null||g.focus()})}},U=function(){C()},$=function(g){if(I.current){var f=g.composedPath();f.includes(I.current)||(n==null||n(!0),w(!1))}},O=function(g){if(["Enter","Space"].includes(g.code)){var f;g.preventDefault(),n==null||n(!0),w(!1),M((f=I.current)===null||f===void 0?void 0:f.innerText);var p=window.getSelection();p==null||p.removeAllRanges();var T=document.createRange();T.selectNodeContents(t),T.collapse(!1),p==null||p.addRange(T),setTimeout(function(){t.focus()});return}};return(0,d.useEffect)(function(){var b=I.current;b&&(b.addEventListener("dblclick",U),b.addEventListener("keydown",O),document.addEventListener("mousedown",$),C())},[]),(0,y.jsx)("span",{className:j()("editable-tag",s),ref:I,contentEditable:h,"data-placeholder":c,"data-mention-char":r.mentionChar,"data-value":m})},le=ae,re=E(17061),q=E.n(re),ie=E(17156),oe=E.n(ie),P;(function(i){i.Up="ArrowUp",i.Down="ArrowDown",i.Left="ArrowLeft",i.Right="ArrowRight",i.Enter="Enter",i.Space="Space"})(P||(P={}));var ue=E(38416),de=E.n(ue),se=function(l,r){var t=Array.from(l),n=t.indexOf(r),s=null;return n>-1&&n>0&&(s=t[n-1]),s},ce=function(l,r){var t=Array.from(l),n=t.indexOf(r),s=null;return n>-1&&n<t.length-1&&(s=t[n+1]),s},ve=(0,d.forwardRef)(function(i,l){var r=i.options,t=i.focusedItemClassname,n=i.wrapClassname,s=i.onValueChange,c=(0,d.useState)(r!=null?r:[]),R=D()(c,2),A=R[0],h=R[1],w=(0,d.useState)(),S=D()(w,2),v=S[0],m=S[1],M=(0,d.useState)(!0),I=D()(M,2),C=I[0],U=I[1],$=(0,d.useState)(),O=D()($,2),b=O[0],g=O[1],f=(0,d.useRef)(null),p=(0,d.useRef)(),T=function(){var e=f.current;if(!e)return null;var o=e.querySelectorAll('[role="option"]'),u=e.querySelector("[data-value='".concat(p.current,"']"))||o[0];return u?(u.setAttribute("aria-selected","true"),t&&u.classList.add(t),u):null},J=function(e){U(e)},Q=function(e){h(e)},H=function(e){p.current=e,m(e),T()},x=function(e){var o=f.current;if(o){var u=T(),L=o.querySelectorAll('[role="option"]');if(u){var V=e.code;switch(V){case P.Down:{var N=ce(L,u);if(N){var B;u.removeAttribute("aria-selected"),N.setAttribute("aria-selected","true"),t&&(u.classList.remove(t),N.classList.add(t)),p.current=String((B=N.getAttribute("data-value"))!==null&&B!==void 0?B:"")}break}case P.Up:{var k=se(L,u);if(k){var F;u.removeAttribute("aria-selected"),k.setAttribute("aria-selected","true"),t&&(u.classList.remove(t),k.classList.add(t)),p.current=String((F=k.getAttribute("data-value"))!==null&&F!==void 0?F:"")}break}case P.Enter:{e.preventDefault();var _=u.dataset,X=_.label,Y=_.value;s==null||s({label:X!=null?X:"",value:Y!=null?Y:""});break}}}}},W=(0,d.useMemo)(function(){return b!=null&&b.length?A.filter(function(a){return a.label.includes(b)}):A},[b,A]);return(0,d.useEffect)(function(){var a,e=f.current;if(!(!e||!C))return e.addEventListener("keydown",x),(a=f.current)===null||a===void 0||a.focus(),T(),function(){e.removeEventListener("keydown",x)}},[C]),(0,d.useImperativeHandle)(l,function(){return{setPanelOptions:Q,setPanelValue:H,setPanelVisible:J,focusPanel:function(){var e;(e=f.current)===null||e===void 0||e.focus()},tranformKeyboardEvent:x,triggerSearch:g}}),(0,y.jsx)("div",{className:j()("lofi-select-panel",n),role:"listbox",ref:f,tabIndex:0,children:W.map(function(a){return(0,y.jsx)("div",{className:j()("lofi-select-panel__item",de()({},"lofi-select-panel__item-active",v===a.value)),"data-value":a.value,"data-label":a.label,role:"option",onClick:function(){return s(a)},children:a.label},a.value)})})}),fe=ve,me=function(l){var r=l.mentionAtom,t=l.lofiInputEle,n=l.setLofiInputEditable,s=r.classname,c=r.searchable,R=r.focusedItemClassname,A=r.panelWrapClassname,h=r.dataSource,w=r.mentionChar,S=(0,d.useRef)(null),v=(0,d.useRef)(),m=(0,d.useRef)(null),M=(0,d.useState)(),I=D()(M,2),C=I[0],U=I[1],$=(0,d.useState)(!1),O=D()($,2),b=O[0],g=O[1],f=function(){var e=S.current;if(e){n==null||n(!1),g(!0);var o=window.getSelection();o==null||o.removeAllRanges();var u=document.createRange();u==null||u.selectNodeContents(e),o==null||o.addRange(u),setTimeout(function(){e==null||e.focus()})}},p=function(){var e=window.getSelection();e==null||e.removeAllRanges();var o=document.createRange();o.selectNodeContents(t),o.collapse(!1),e==null||e.addRange(o),setTimeout(function(){t.focus()})},T=function(){var e;v.current&&((e=m.current)===null||e===void 0||e.setPanelVisible(!1),v.current.style.display="none")},J=function(e){var o=S.current;if(o){if([P.Space].includes(e.code)){e.preventDefault(),n==null||n(!0),g(!1),T(),p();return}if([P.Up,P.Down,P.Enter].includes(e.code)){var u;e.preventDefault(),(u=m.current)===null||u===void 0||u.tranformKeyboardEvent(e),e.code===P.Enter&&setTimeout(function(){var L;(L=m.current)===null||L===void 0||L.triggerSearch()});return}setTimeout(function(){var L,V=o.innerText;(L=m.current)===null||L===void 0||L.triggerSearch(V)})}},Q=function(){var a=oe()(q()().mark(function e(o){var u;return q()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:U(o),T(),c&&(n==null||n(!0),g(!1)),(u=m.current)===null||u===void 0||u.setPanelValue(o.value),p();case 5:case"end":return V.stop()}},e)}));return function(o){return a.apply(this,arguments)}}(),H=function(){var e,o,u=S.current;if(!(!u||!(r!=null&&r.dataSource))){if(!v.current){var L=document.createElement("div");L.setAttribute("class","lofi-dropdown-container"),v.current=L;var V=t.getBoundingClientRect(),N=V.height,B=V.left,k=u.getBoundingClientRect(),F=k.left;v.current.style.top=N+"px",v.current.style.left=F-B+"px",(0,z.render)((0,y.jsx)(fe,{focusedItemClassname:R,wrapClassname:A,ref:m,options:h==null?void 0:h.data,onValueChange:Q}),v.current)}v.current.style.display="unset",(e=m.current)===null||e===void 0||e.setPanelVisible(!0),t==null||(o=t.parentNode)===null||o===void 0||o.appendChild(v.current)}},x=function(e){if(!(!v.current||!S.current)){var o=e.composedPath();!o.includes(v.current)&&!o.includes(S.current)&&T()}},W=function(){H(),setTimeout(function(){c&&f()})};return(0,d.useEffect)(function(){var a;h!=null&&h.data&&((a=m.current)===null||a===void 0||a.setPanelOptions(h==null?void 0:h.data))},[h==null?void 0:h.data]),(0,d.useEffect)(function(){var a=S.current;return a&&(a.addEventListener("dblclick",W),a.addEventListener("keydown",J),document.addEventListener("click",x),H(),setTimeout(function(){c&&f()})),function(){a==null||a.removeEventListener("dblclick",W),document.removeEventListener("click",x)}},[c]),(0,y.jsx)("span",{ref:S,className:j()("selectable-tag",s),contentEditable:b,"data-mention":w,"data-placeholder":"\u8BF7\u9009\u62E9\u54C8\u54C8\u54C8\u54C8\u54C8\u54C8\u54C8","data-value":C==null?void 0:C.value,children:C==null?void 0:C.label})},pe=me,he=function(l){var r=l.lofiInputEle,t=l.mention,n=l.setLofiInputEditable,s=document.createElement("span");(0,z.render)((0,y.jsx)(le,{lofiInputEle:r,mentionAtom:t,setLofiInputEditable:n}),s);var c=window.getSelection();c==null||c.getRangeAt(0).insertNode(s.childNodes[0])},Ee=function(l){var r=l.mention,t=l.lofiInputEle,n=l.setLofiInputEditable,s=document.createElement("span");(0,z.render)((0,y.jsx)(pe,{mentionAtom:r,lofiInputEle:t,setLofiInputEditable:n}),s);var c=window.getSelection();c==null||c.getRangeAt(0).insertNode(s.childNodes[0])},ge=function(l,r,t,n){var s=r.key,c=t==null?void 0:t.find(function(R){return R.mentionChar===s});if(c){r.preventDefault(),c.mode==="editable"?he({lofiInputEle:l,mention:c,setLofiInputEditable:n}):Ee({lofiInputEle:l,mention:c,setLofiInputEditable:n});return}},be=(0,d.forwardRef)(function(i,l){var r=i.classname,t=i.mentionList,n=i.placeholder,s=i.wrapClassname,c=(0,d.useState)(!0),R=D()(c,2),A=R[0],h=R[1],w=(0,d.useRef)(null),S=function(m){h(m)};return(0,d.useEffect)(function(){var v=w.current;v&&v.addEventListener("keydown",function(m){return ge(v,m,t,S)})},[]),(0,d.useImperativeHandle)(l,function(){return{getValue:function(){var m;return(m=w.current)===null||m===void 0?void 0:m.innerText}}}),(0,y.jsx)("div",{className:j()(s,"lofi-input-wrap"),children:(0,y.jsx)("div",{className:j()(r,"lofi-input"),ref:w,contentEditable:A,"data-placeholder":n})})}),Se=be,Le=Se,K=function(l){return new Array(12).fill(1).map(function(r,t){return{label:"".concat(l?"[".concat(l,"]"):"","option_").concat(t+1),value:String(t+1)+(l||"")}})},Ie=K("").map(function(i){return G()(G()({},i),{},{children:K(i.value).map(function(l){return G()(G()({},l),{},{children:K(i.value+l.value)})})})});console.log(Ie);var Ce=function(){var i=[{mentionChar:"$",classname:"edit",mode:"editable",placeholder:"\u8BF7\u8F93\u5165\u5E38\u6570"},{mentionChar:"@",mode:"selectable",classname:"search",dataSource:{type:"select",data:K("search")},searchable:!0},{mentionChar:"#",mode:"selectable",classname:"select",dataSource:{type:"select",data:K("select")},searchable:!1}];return(0,y.jsx)(Le,{mentionList:i,placeholder:"\u8BF7\u8F93\u5165......"})}}}]);
